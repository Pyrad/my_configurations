#! /bin/sh
if [ -e "key" -o -e "cipher" ]
then
	echo "fobidden to run in this folder"
	exit 1
fi
wget "http://www.picb.ac.cn/~xiaohang/vimwiki/tools/commands/des/key" > .temp 2>&1
wget "http://www.picb.ac.cn/~xiaohang/vimwiki/tools/commands/des/cipher" > .temp 2>&1
while [ ! -e key -o ! -e cipher ]
do
	wait
done
mv key .key
mv cipher .cipher
KEY=`cat .key`
SAVEDSTTY=`stty -g`
stty -echo
echo "password: "
read PASSWORD
stty $SAVEDSTTY
if [ "$PASSWORD" != "$KEY" ]
then
	echo "error password"
	rm .key
	rm .cipher
	rm .temp
	exit 1
fi

des_decrypt .cipher .key .plain > .temp
awk '{print NR ":" $1}' .plain
echo -n "Which item do you want to see ? [#]"
read NUM
cmd="awk '(NR==$NUM)' .plain"
eval $cmd

rm  .key
rm  .cipher
rm .plain
rm .temp
